<h1>Car Gallery</h1>
<p>
    <a (click)="openCreateModal(template)">Add New Car</a>
</p>

<ng-template #template>
    <div class="modal-header">
        <div>
            <h1 class="modal-title pull-left">Create Car</h1>
        </div>
        <button type="button" class="close pull-right" aria-label="Close" (click)="decline()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form [formGroup]="form" (ngSubmit)="createVehicle(form)">
            <alert type="danger" *ngIf="errorMessage">{{ errorMessage }}</alert>
            <accordion>
                <accordion-group
                    class="mb-3"
                    formGroupName="contact"
                    (isOpenChange)="openAccordion($event)"
                    [isOpen]="isOpen"
                >
                    <div accordion-heading>
                        <div class="pull-left float-left mr-5 readonly-label">Contact</div>
                        <span class="badge badge-danger text-center" *ngIf="errorMessage">{{ errorMessage }}</span>
                        <span *ngIf="isOpen" class="pull-right"><i class="fa fa-caret-down"></i></span>
                        <span *ngIf="!isOpen" class="pull-right"><i class="fa fa-caret-right"></i></span>
                    </div>
                    <div class="mb-3">
                        <label>Name</label>
                        <input type="text" class="form-control" formControlName="contactName" />
                        <span
                            *ngIf="
                                isSubmitted &&
                                form
                                    .get('contact')
                                    .get('contactName')
                                    .hasError('required')
                            "
                            style="color: red"
                            >Name is required</span
                        >
                    </div>
                    <div class="mb-3">
                        <label>Email</label>
                        <input type="text" class="form-control" formControlName="contactEmail" />
                        <span
                            *ngIf="
                                isSubmitted &&
                                form
                                    .get('contact')
                                    .get('contactEmail')
                                    .hasError('required')
                            "
                            style="color: red"
                            >Email is required</span
                        >
                    </div>

                    <div class="mb-3">
                        <label>Phone</label>
                        <input type="text" class="form-control" formControlName="contactPhone" />
                        <span
                            *ngIf="
                                isSubmitted &&
                                form
                                    .get('contact')
                                    .get('contactPhone')
                                    .hasError('required')
                            "
                            style="color: red"
                            >Phone is required</span
                        >
                    </div>
                </accordion-group>
            </accordion>
            <div>
                <div>
                    <div class="mb-3">
                        <label>Brand</label>
                        <input type="text" class="form-control" formControlName="brand" />
                        <span *ngIf="isSubmitted && form.get('brand').hasError('required')" style="color: red"
                            >Brand is required</span
                        >
                    </div>
                    <div class="mb-3">
                        <label>model</label> <input type="text" class="form-control" formControlName="model" />
                        <span *ngIf="isSubmitted && form.get('model').hasError('required')" style="color: red"
                            >Model is required</span
                        >
                    </div>
                    <div class="mb-3">
                        <label>Year</label> <input type="text" class="form-control" formControlName="year" />
                        <span *ngIf="isSubmitted && form.get('year').hasError('required')" style="color: red"
                            >Year is required</span
                        >
                    </div>
                    <div class="mb-3">
                        <label>Price($)</label> <input type="text" class="form-control" formControlName="price" />
                        <span *ngIf="isSubmitted && form.get('price').hasError('required')" style="color: red"
                            >Price is required</span
                        >
                    </div>
                    <div class="mb-3">
                        <label>Photo</label>
                        <input type="text" class="form-control" formControlName="photo" />
                    </div>
                </div>

                <button class="btn btn-success mr-2" type="submit">Save</button>
                <button class="btn btn-default" type="button" (click)="decline()">Cancel</button>
            </div>
        </form>
    </div>
</ng-template>

<table *ngIf="vehicles && vehicles.length > 0; else noVehicles" class="table">
    <thead>
        <tr>
            <th scope="col">Photo</th>
            <th scope="col">Brand</th>
            <th scope="col">Model</th>
            <th scope="col">Year</th>
            <th scope="col">Price($)</th>
            <th scope="col"></th>
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let v of vehicles">
            <!--<th scope="row"><img src="https://{{ v.photo }}" alt="[Image Missing]" width="100px" /></th>-->
            <th scope="row"><img src="{{ v.photo || '../../../assets/user.png' }}" width="100px" /></th>
            <td>{{ v.brand }}</td>
            <td>{{ v.model }}</td>
            <td>{{ v.year }}</td>
            <td>{{ v.price }}</td>
            <td>
                <a class="mr-1" [routerLink]="['edit', v.vehicleId]">Edit</a>|<a
                    class="ml-1 mr-1"
                    [routerLink]="['detail', v.vehicleId]"
                    >Details</a
                >|<a class="ml-1" (click)="openDeleteModal(deleteTemplate)">Delete</a>
            </td>

            <ng-template #deleteTemplate>
                <div class="modal-body text-center">
                    <p>Are you sure you want to delete this vehicle?</p>
                    <button type="button" class="btn btn-danger mr-2" (click)="confirm(v.vehicleId)">Delete</button>
                    <button type="button" class="btn btn-default" (click)="decline()">Cancel</button>
                </div>
            </ng-template>
        </tr>
    </tbody>
</table>
<ng-template #noVehicles>
    <h1>No vehicles avalaible</h1>
</ng-template>
